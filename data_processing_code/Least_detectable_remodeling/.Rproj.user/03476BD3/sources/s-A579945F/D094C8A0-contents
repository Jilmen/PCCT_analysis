library(dplyr)
library(tidyr)
library(ggplot2)

data <- read.table('in_situ.txt', sep=',', 
                     col.names = c('threshold','formation_raw', 'resorption_raw','formation_filtered','resorption_filtered','identifier'))

data_tidy <- data %>% pivot_longer(cols=c('formation_raw','formation_filtered','resorption_raw','resorption_filtered'), names_to='remodeling_processing', values_to='values') %>%
                      separate(col='remodeling_processing', into=c('remodeling','processing')) %>%
                      pivot_wider(names_from='remodeling', values_from = 'values') %>%
                      separate(col='identifier', into=c('schijf','info'), sep=':spec') %>%
                      separate(col='info', into=c('specimen','label','bone'), sep='_') %>%
                      select(threshold, formation, resorption, processing, specimen, bone) %>%
                      mutate(resorption = -resorption)


data_sum <- data_tidy %>% group_by(threshold, processing) %>% summarize(mean_formation = mean(formation), 
                                                                        mean_resorption=mean(resorption),
                                                                        sd_formation = sd(formation),
                                                                        sd_resorption = sd(resorption)) %>%
                                                              mutate(total = mean_formation - mean_resorption)

g2 <- ggplot(data_sum) +geom_point(aes(x=threshold, y=mean_formation, shape=processing, color='Formation'), size=3) +
                        geom_point(aes(x=threshold, y=mean_resorption, shape=processing, color='Resorption'),size=3) +
                        geom_line(aes(x=threshold, y=mean_formation, linetype=processing, color = 'Formation'),size=0.7) +
                        geom_line(aes(x=threshold, y=mean_resorption, linetype=processing, color='Resorption'),size=0.7) +
                        scale_x_continuous(n.breaks = 6)+
                        scale_y_continuous(n.breaks=12)+
                        labs(x='threshold [mgHA/cmÂ³]',y='mean remodeling [%]', size=40) + theme_classic()
